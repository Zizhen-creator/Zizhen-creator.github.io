<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ¬¢è¿ä¹˜åG7520æ¬¡å¤©æ°”ä¸“åˆ—</title>

    <!-- âœ… è‡ªå®šä¹‰å­—ä½“ -->
    <style>
    @font-face {
        font-family: 'Loli';
        src: url('loli.ttf') format('truetype');
    }

    body {
        font-family: 'Loli', Arial, sans-serif;
        background: 
            linear-gradient(rgba(255,255,255,0.2), rgba(255,255,255,0.2)),
            url('./IMG_3307.webp') no-repeat center center fixed;
        background-size: cover;
        min-height: 100vh;
        margin: 0;
        padding: 20px;
        color: #333;
    }

    .container {
        max-width: 600px;
        min-height: 700px;
        margin: 0 auto;
        padding: 30px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(8px);
        border-radius: 15px;
        box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.5);

        /* âœ… å¯æ‹–åŠ¨æµ®çª—è®¾ç½® */
        position: absolute;
        top: 100px;
        left: 100px;
        cursor: move;
    }

    .location input {
        font-family: 'Loli', Arial, sans-serif;
        padding: 10px;
        margin-right: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
    }

    .location button,
    button {
        font-family: 'Loli', Arial, sans-serif;
        padding: 10px 15px;
        border: none;
        background-color: #c5a0f7;
        color: white;
        border-radius: 5px;
        cursor: pointer;
    }

    .location button:hover,
    button:hover {
        background-color: #b88ee4;
    }

    .weather-icon {
        font-size: 48px;
        margin-top: 20px;
    }

    .temp {
        font-size: 32px;
        margin: 10px 0;
    }

    .outfit {
        margin-top: 20px;
    }

    .special-message {
        margin-top: 15px;
        font-style: italic;
        color: #555;
    }
    </style>
</head>

<body>
    <div class="container" id="draggable">
        <h1>ğŸ‘— èŠ®èŠ®ä»Šæ—¥ç©¿æ­åŠ©æ‰‹</h1>
        <p class="subtitle">ä¸“ä¸ºèŠ®èŠ®å®šåˆ¶çš„å¤©æ°”ç©¿æ­æŒ‡å—</p>

        <div class="location">
            <input type="text" id="cityInput" placeholder="è¾“å…¥åŸå¸‚åç§°" value="shaoxing" />
            <button onclick="getWeather()">è·å–å¤©æ°”</button>
        </div>

        <div class="weather-icon" id="weatherIcon">â›…</div>
        <div class="temp" id="temperature">--Â°C</div>
        <div id="weatherDesc">åŠ è½½ä¸­...</div>

        <div class="outfit">
            <h3>ğŸ‘š ä»Šæ—¥æ¨èç©¿æ­</h3>
            <p id="outfitSuggestion">æ­£åœ¨ç”Ÿæˆå»ºè®®...</p>
        </div>

        <div class="special-message" id="specialMessage"></div>

        <button onclick="switchToMyCity()">ğŸ’‘ çœ‹çœ‹TAé‚£è¾¹çš„å¤©æ°”</button>
    </div>

    <!-- âœ… è„šæœ¬éƒ¨åˆ† -->
    <script>
        const MY_CITY = "ä¸Šæµ·";
        const API_KEY = "8ae8c40104c5450f3a1a75c74b4d44ae";

        async function getWeather() {
            const city = document.getElementById('cityInput').value || 'åŒ—äº¬';
            try {
                const response = await fetch(
                    `https://api.openweathermap.org/data/2.5/weather?q=${city},cn&units=metric&appid=${API_KEY}&lang=zh_cn`
                );
                const data = await response.json();
                console.log("å¤©æ°”æ•°æ®è¿”å›ï¼š", data);

                if (data.cod !== 200) {
                    alert(`è·å–å¤©æ°”å¤±è´¥ï¼š${data.message}`);
                    return;
                }

                updateWeatherUI(data);
                generateOutfitSuggestion(data);
                checkSpecialConditions(data);
            } catch (error) {
                console.error("è¯·æ±‚å¤±è´¥ï¼š", error);
                alert("æ— æ³•è·å–å¤©æ°”æ•°æ®ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–ç¨åå†è¯•ã€‚");
            }
        }

        function updateWeatherUI(data) {
            document.getElementById('temperature').textContent = `${Math.round(data.main.temp)}Â°C`;
            document.getElementById('weatherDesc').textContent = data.weather[0].description;
            const icon = document.getElementById('weatherIcon');
            const weatherId = data.weather[0].id;
            icon.textContent = getWeatherIcon(weatherId);
        }

        function getWeatherIcon(id) {
            if (id >= 200 && id < 300) return "â›ˆï¸";
            if (id >= 300 && id < 600) return "ğŸŒ§ï¸";
            if (id >= 600 && id < 700) return "â„ï¸";
            if (id === 800) return "â˜€ï¸";
            if (id > 800) return "â˜ï¸";
            return "â›…";
        }

        function generateOutfitSuggestion(data) {
            const temp = data.main.temp;
            const weather = data.weather[0].main.toLowerCase();
            let suggestion = "";

            if (temp <= 0) suggestion = "ğŸ§¥ åšç¾½ç»’æœ+æ¯›è¡£+åŠ ç»’è£¤+é›ªåœ°é´";
            else if (temp <= 10) suggestion = "ğŸ§£ å‘¢å¤§è¡£/æ£‰æœ+é’ˆç»‡è¡«+ç‰›ä»”è£¤+çŸ­é´";
            else if (temp <= 20) suggestion = "ğŸ‘” å«è¡£/è–„å¤–å¥—+Tæ¤+ä¼‘é—²è£¤";
            else if (temp <= 28) suggestion = "ğŸ‘• è¡¬è¡«/Tæ¤+ç‰›ä»”è£¤/è£™å­";
            else suggestion = "ğŸ©³ çŸ­è¢–+çŸ­è£¤/è¿è¡£è£™+å‡‰é‹";

            if (weather.includes("rain")) suggestion += " â˜” è®°å¾—å¸¦ä¼å“¦ï¼";
            if (weather.includes("snow")) suggestion += " â„ï¸ å°å¿ƒåœ°æ»‘ï¼";

            document.getElementById('outfitSuggestion').textContent = suggestion;
        }

        function checkSpecialConditions(data) {
            const weather = data.weather[0].main;
            let message = "";

            if (weather.includes("Rain")) {
                message = "ä»Šå¤©æœ‰é›¨ï¼Œå‡ºé—¨è®°å¾—å¸¦ä¼ â˜”";
            } else if (weather.includes("Snow")) {
                message = "ä¸‹é›ªå•¦ï¼æ³¨æ„ä¿æš–å’Œé˜²æ»‘ â›„";
            }

            document.getElementById("specialMessage").textContent = message;
        }

        function switchToMyCity() {
            document.getElementById('cityInput').value = MY_CITY;
            getWeather();
        }

        // é»˜è®¤åŠ è½½ä¸€æ¬¡
        window.onload = getWeather;

        // âœ… æ‹–åŠ¨åŠŸèƒ½
        const dragItem = document.getElementById("draggable");
        let offsetX, offsetY;

        dragItem.addEventListener('mousedown', (e) => {
            offsetX = e.clientX - dragItem.getBoundingClientRect().left;
            offsetY = e.clientY - dragItem.getBoundingClientRect().top;
            document.addEventListener('mousemove', moveAt);
            document.addEventListener('mouseup', stopMove);
        });

        function moveAt(e) {
            dragItem.style.left = `${e.clientX - offsetX}px`;
            dragItem.style.top = `${e.clientY - offsetY}px`;
        }

        function stopMove() {
            document.removeEventListener('mousemove', moveAt);
            document.removeEventListener('mouseup', stopMove);
        }
    </script>
</body>
</html>
